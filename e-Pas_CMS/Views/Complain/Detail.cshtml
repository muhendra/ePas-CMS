@model e_Pas_CMS.ViewModels.ComplainDetailViewModel
@{
    ViewData["Title"] = Model.IsBanding ? "Detail Banding" : "Detail Komplain";

    string statusClass = "bg-warning text-dark";
    string statusText = Model.StatusText ?? "-";
    switch ((Model.StatusCode ?? "").Trim().ToUpperInvariant())
    {
        case "APPROVED": statusClass = "bg-success"; break;
        case "REJECTED": statusClass = "bg-danger"; break;
        default: statusClass = "bg-warning"; break;
    }
}

<style>
    .card-soft {
        border: 1px solid #eef2f7;
        border-radius: .75rem;
    }

    .section-title {
        font-weight: 600;
        font-size: 1.05rem;
        margin-bottom: .75rem;
    }

    .kv .label {
        color: #6b7280;
        font-size: .85rem;
    }

    .kv .value {
        font-weight: 500;
    }

    .banner-status {
        border-radius: .75rem;
        font-weight: 600;
        text-align: center;
        padding: .9rem 1rem;
    }

    .muted {
        color: #6b7280;
    }

    .min-h-row {
        min-height: 28px;
    }

    .table-sm th, .table-sm td {
        vertical-align: middle;
    }

    .banner-status {
        border-radius: .75rem;
        text-align: center;
        padding: 1rem;
    }
</style>

<div class="container-fluid px-0">

    <!-- Breadcrumb + Title -->
    <div class="mb-3">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb small mb-1">
                <li class="breadcrumb-item"><a asp-controller="Complain" asp-action="Index">Komplain &amp; Banding</a></li>
                <li class="breadcrumb-item active" aria-current="page">@ViewData["Title"]</li>
            </ol>
        </nav>
        <h4 class="mb-0">@ViewData["Title"]</h4>
    </div>

    <!-- Status Banner -->
    <div class="mb-3">
        <div class="banner-status @statusClass text-white">
            <h4 class="fw-bold mb-0">@statusText</h4>
        </div>
    </div>

    <!-- Informasi SPBU -->
    <div class="card card-soft mb-3">
        <div class="card-body">
            <div class="section-title">Informasi SPBU</div>
            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-3 kv">
                <div class="col">
                    <div class="label">Nomor SPBU</div>
                    <div class="value min-h-row">@Model.NoSpbu</div>
                </div>
                <div class="col">
                    <div class="label">Region</div>
                    <div class="value min-h-row">@Model.Region</div>
                </div>
                <div class="col">
                    <div class="label">Kabupaten/Kota</div>
                    <div class="value min-h-row">@Model.City</div>
                </div>
                <div class="col">
                    <div class="label">Alamat SPBU</div>
                    <div class="value min-h-row">@Model.Address</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Informasi Kegiatan Audit -->
    <div class="card card-soft mb-3">
        <div class="card-body">
            <div class="section-title">Informasi Kegiatan Audit</div>
            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-3 kv">
                <div class="col">
                    <div class="label">No. Report</div>
                    <div class="value">@Model.ReportNo</div>
                </div>
                <div class="col">
                    <div class="label">Tanggal Audit</div>
                    <div class="value">
                        @(Model.TanggalAudit.HasValue ? Model.TanggalAudit.Value.ToString("dd/MM/yyyy, HH:mm") + " WIB" : "-")
                    </div>
                </div>
                <div class="col">
                    <div class="label">Sent Date</div>
                    <div class="value">
                        @(Model.SentDate.HasValue ? Model.SentDate.Value.ToString("dd/MM/yyyy, HH:mm") + " WIB" : "-")
                    </div>
                </div>
                <div class="col">
                    <div class="label">Verifikator</div>
                    <div class="value">@(!string.IsNullOrWhiteSpace(Model.Verifikator) ? Model.Verifikator : "-")</div>
                </div>
                <div class="col">
                    <div class="label">Auditor 1</div>
                    <div class="value">@(!string.IsNullOrWhiteSpace(Model.Auditor1) ? Model.Auditor1 : "-")</div>
                </div>
                <div class="col">
                    <div class="label">Auditor 2</div>
                    <div class="value">@(!string.IsNullOrWhiteSpace(Model.Auditor2) ? Model.Auditor2 : "-")</div>
                </div>
                <div class="col">
                    <div class="label">Tipe Audit</div>
                    <div class="value">@Model.TipeAudit</div>
                </div>
                <div class="col">
                    <div class="label">Next Audit</div>
                    <div class="value">@Model.NextAudit</div>
                </div>
                <div class="col">
                    <div class="label">Ko-ordinator</div>
                    <div class="value">@(!string.IsNullOrWhiteSpace(Model.Koordinator) ? Model.Koordinator : "-")</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Informasi Komplain/Banding -->
    <div class="card card-soft mb-3">
        <div class="card-body">
            <div class="section-title">Informasi @(Model.IsBanding ? "Banding" : "Komplain")</div>
            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-3 kv">
                <div class="col">
                    <div class="label">Nomor Tiket</div>
                    <div class="value">@Model.TicketNo</div>
                </div>
                <div class="col">
                    <div class="label">Nomor Banding</div>
                    <div class="value">@(!string.IsNullOrWhiteSpace(Model.NomorBanding) ? Model.NomorBanding : "-")</div>
                </div>
                <div class="col">
                    <div class="label">Status @(Model.IsBanding ? "Banding" : "Komplain")</div>
                    <div class="value">@statusText</div>
                </div>
                <div class="col">
                    <div class="label">Tgl Pengajuan</div>
                    <div class="value">
                        @(Model.CreatedDate.HasValue ? Model.CreatedDate.Value.ToString("dd/MM/yyyy, HH:mm") + " WIB" : "-")
                    </div>
                </div>
            </div>

            @if (Model.Points != null && Model.Points.Any())
            {
                <div class="mt-3">
                    <div class="section-title mb-2">Poin @(Model.IsBanding ? "Banding" : "Komplain")</div>
                    <div class="table-responsive">
                        <table class="table table-sm align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th style="width:120px">Element</th>
                                    <th style="width:140px">Sub Element</th>
                                    <th style="width:160px">Detail Element</th>
                                    <th>Detail yang @(Model.IsBanding ? "dibantah" : "dikomplain")</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var p in Model.Points)
                                {
                                    <tr>
                                        <td>@p.Element</td>
                                        <td>@p.SubElement</td>
                                        <td>@p.DetailElement</td>
                                        <td>@p.DetailDibantah</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            }
        </div>
    </div>

    <!-- Isi Banding/Komplain -->
    <div class="card card-soft mb-3">
        <div class="card-body">
            <div class="section-title">Isi @(Model.IsBanding ? "Banding" : "Komplain")</div>
            <div class="muted">
                @(string.IsNullOrWhiteSpace(Model.BodyText) ? "-" : Model.BodyText)
            </div>
        </div>
    </div>

    <!-- Dokumen Pendukung -->
    <div class="card card-soft mb-4">
        <div class="card-body">
            <div class="section-title">Dokumen Pendukung</div>
            @if (Model.Attachments != null && Model.Attachments.Any())
            {
                <ul class="list-unstyled mb-0">
                    @foreach (var f in Model.Attachments)
                    {
                        <li class="mb-1">
                            <a asp-controller="Complain" asp-action="Download" asp-route-id="@f.Id" class="link-primary text-decoration-none">
                                @(!string.IsNullOrWhiteSpace(f.FileName) ? f.FileName : "Lampiran")
                            </a>
                            @if (!string.IsNullOrEmpty(f.SizeReadable))
                            {
                                <span class="text-muted small ms-2">(@f.SizeReadable)</span>
                            }
                        </li>
                    }
                </ul>
            }
            else
            {
                <div class="muted">Tidak ada dokumen pendukung.</div>
            }
        </div>
    </div>

    <!-- Action buttons -->
    <div class="d-flex gap-2">
        <a asp-controller="Complain" asp-action="Index" class="btn btn-outline-secondary">&laquo; Kembali</a>

        @if (Model.CanApprove)
        {
            <form asp-controller="Complain" asp-action="Approve" method="post" class="d-inline">
                <input type="hidden" name="id" value="@Model.Id" />
                <button type="submit" class="btn btn-success">Setujui</button>
            </form>
        }
        @if (Model.CanReject)
        {
            <a asp-controller="Complain" asp-action="Reject" asp-route-id="@Model.Id" class="btn btn-danger">Tolak</a>
        }
    </div>

</div>
