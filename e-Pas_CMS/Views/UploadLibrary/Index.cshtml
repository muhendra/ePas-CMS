@model YourApp.Controllers.UploadLibraryController.LibraryVm
@using static YourApp.Controllers.UploadLibraryController

@{
    ViewData["Title"] = "Upload Library";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h4 class="mb-1">Upload Library</h4>
            <div class="text-muted">Base: /var/www/epas-asset/wwwroot/uploads</div>
        </div>
    </div>

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-warning">@TempData["Error"]</div>
    }

    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb">
            @for (int i = 0; i < Model.Breadcrumbs.Count; i++)
            {
                var (name, rel) = Model.Breadcrumbs[i];
                var isLast = i == Model.Breadcrumbs.Count - 1;
                if (isLast)
                {
                    <li class="breadcrumb-item active">@name</li>
                }
                else
                {
                    <li class="breadcrumb-item">
                        <a href="@Url.Action("Index", new { folder = rel, q = Model.Query })">@name</a>
                    </li>
                }
            }
        </ol>
    </nav>

    <!-- Search -->
    <form method="get" class="row g-2 mb-3">
        <input type="hidden" name="folder" value="@Model.CurrentRel" />
        <div class="col-md-6">
            <input class="form-control" name="q" value="@Model.Query" placeholder="Search nama file/folder..." />
        </div>
        <div class="col-md-2">
            <button class="btn btn-primary w-100" type="submit">Search</button>
        </div>
        <div class="col-md-2">
            <a class="btn btn-outline-secondary w-100" href="@Url.Action("Index", new { folder = Model.CurrentRel })">Reset</a>
        </div>
    </form>

    <div class="card">
        <div class="card-body">

            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead>
                        <tr>
                            <th style="width: 40%;">Name</th>
                            <th style="width: 15%;">Type</th>
                            <th style="width: 15%;">Size</th>
                            <th style="width: 20%;">Modified</th>
                            <th style="width: 10%;" class="text-end">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (!Model.Folders.Any() && !Model.Files.Any())
                        {
                            <tr>
                                <td colspan="5" class="text-muted">Tidak ada data.</td>
                            </tr>
                        }

                        @foreach (var d in Model.Folders)
                        {
                            <tr>
                                <td>
                                    <a href="@Url.Action("Index", new { folder = d.RelPath, q = Model.Query })">
                                        📁 @d.Name
                                    </a>
                                </td>
                                <td>Folder</td>
                                <td class="text-muted">-</td>
                                <td>@d.LastWriteTime.ToString("yyyy-MM-dd HH:mm")</td>
                                <td class="text-end">
                                    <form method="post" action="@Url.Action("DeleteFolder")" class="d-inline"
                                          onsubmit="return confirm('Hapus folder kosong: @d.Name ?');">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="path" value="@d.RelPath" />
                                        <input type="hidden" name="returnFolder" value="@Model.CurrentRel" />
                                        <input type="hidden" name="q" value="@Model.Query" />
                                        <button class="btn btn-sm btn-outline-danger">Delete</button>
                                    </form>
                                </td>
                            </tr>
                        }

                        @foreach (var f in Model.Files)
                        {
                            <tr>
                                <td>📄 @f.Name</td>
                                <td>File</td>
                                <td>@(f.SizeBytes.HasValue ? HumanSize(f.SizeBytes.Value) : "-")</td>
                                <td>@f.LastWriteTime.ToString("yyyy-MM-dd HH:mm")</td>
                                <td class="text-end">
                                    <a class="btn btn-sm btn-outline-primary"
                                       href="@Url.Action("Download", new { path = f.RelPath })">Download</a>

                                    <form method="post" action="@Url.Action("DeleteFile")" class="d-inline"
                                          onsubmit="return confirm('Hapus file: @f.Name ?');">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="path" value="@f.RelPath" />
                                        <input type="hidden" name="returnFolder" value="@Model.CurrentRel" />
                                        <input type="hidden" name="q" value="@Model.Query" />
                                        <button class="btn btn-sm btn-outline-danger">Delete</button>
                                    </form>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

        </div>
    </div>
</div>
